<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle %></title>
    <link rel="stylesheet" href="/css/style.css">
    
    <style>
        /* D√©finition des variables de th√®me */
        :root {
            --main-bg-color: #1a1a2e; /* Fond principal sombre */
            --card-bg-color: #2c2c44; /* Fond des cartes/panneaux */
            --text-color: #f0f0f0; /* Texte clair */
            --secondary-color: #cccccc; /* Texte secondaire */
            --primary-color: #3498db; /* Bleu (boutons principaux) */
            --border-color: #444466;
        }

        .light-mode {
            --main-bg-color: #ffffff;
            --card-bg-color: #f7f7f7;
            --text-color: #333333;
            --secondary-color: #666666;
            --primary-color: #3498db;
            --border-color: #dddddd;
        }
        
        body {
            background-color: var(--main-bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            font-family: sans-serif;
            padding: 20px;
        }

        /* Conteneur du Filtre */
        .filter-container {
            background-color: var(--card-bg-color); 
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .filter-form {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            flex-wrap: wrap; 
        }

        .form-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
            flex-grow: 1;
        }
        
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 0.9em;
        }

        .filter-form input[type="text"], 
        .filter-form select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--main-bg-color); 
            color: var(--text-color);
            transition: border-color 0.3s;
            height: 40px; 
            box-sizing: border-box;
        }

        .filter-form input[type="text"]:focus, 
        .filter-form select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* Styles des Boutons de Filtrage */
        .btn-apply, .btn-reset {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            height: 40px; 
            transition: background-color 0.3s, transform 0.1s;
        }

        .btn-apply {
            background-color: #3498db; 
            color: white;
        }

        .btn-apply:hover {
            background-color: #2980b9; 
            transform: translateY(-1px);
        }

        .btn-reset {
            background-color: #95a5a6; 
            color: white;
        }

        .btn-reset:hover {
            background-color: #7f8c8d; 
            transform: translateY(-1px);
        }
        
        /* Styles G√©n√©riques des Boutons d'Action (CORRIG√â POUR LE CENTRAGE DU TEXTE) */
        .btn {
            display: flex; /* Utiliser flexbox pour le centrage */
            align-items: center; /* Centrer verticalement */
            justify-content: center; /* Centrer horizontalement */
            text-align: center; 
            padding: 5px 10px; 
            border-radius: 6px;
            text-decoration: none;
            cursor: pointer;
            font-weight: bold;
            border: none;
            height: 40px; 
            box-sizing: border-box;
            transition: background-color 0.3s;
            white-space: normal; 
            line-height: 1.2; /* Am√©liore l'espacement entre les lignes du texte sur 2 lignes */
        }

        .btn-primary { background-color: #3498db; color: white; }
        .btn-secondary { background-color: #f39c12; color: white; }
        .btn-delete { background-color: #e74c3c; color: white; }
        .btn-primary:hover { background-color: #2980b9; }
        .btn-secondary:hover { background-color: #d35400; }
        .btn-delete:hover { background-color: #c0392b; }
        
        /* Cartes d'Id√©es */
        .idea-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .idea-card {
            background-color: var(--card-bg-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--primary-color);
        }
        
        .idea-card h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        /* Styles pour les Statuts */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-Draft { background-color: #f1c40f; color: #333; }
        .status-InProgress { background-color: #3498db; color: white; }
        .status-Published { background-color: #2ecc71; color: white; }
        .status-Archived { background-color: #95a5a6; color: white; }

        /* Conteneur et proportions des boutons d'action de la carte */
        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Tous les √©l√©ments dans card-actions prennent la m√™me largeur */
        .card-actions a,
        .card-actions form {
            flex-grow: 1;
        }

        /* Assurer que le bouton Supprimer prend 100% de l'espace de son formulaire */
        .card-actions form button {
            width: 100%;
            display: block;
            height: 40px;
            line-height: 20px;
        }
        
        /* Message d'absence d'id√©es */
        .no-ideas-message {
            text-align: center;
            padding: 40px;
            background-color: var(--card-bg-color);
            border-radius: 8px;
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
    
</head>
<body class="<%= (typeof userTheme !== 'undefined' && userTheme === 'light') ? 'light-mode' : '' %>"> 
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <p style="font-size: 1.1em; font-weight: bold; color: var(--text-color);">
            Bonjour, <%= username %> !
        </p>
        
        <div>
            <a href="/global-dashboard" class="btn btn-primary" style="margin-right: 10px;">
                üöÄ Tableau de Bord
            </a>
            
            <button id="theme-toggle" class="btn btn-secondary" style="margin-right: 10px; background-color: #7f8c8d;">
                üåô Mode Nuit
            </button>

            <a href="/logout" class="btn btn-delete">
                Se d√©connecter
            </a>
        </div>
    </div>
    
    <h1><%= pageTitle %></h1>

    <hr style="border-color: var(--border-color);">

    <section class="filter-container">
        <h2>Filtrer et Rechercher les Id√©es</h2>
        
        <form method="GET" action="/" class="filter-form">
            
            <div class="form-group" style="flex-grow: 2;">
                <label for="search">Recherche par Titre/Description :</label>
                <input type="text" id="search" name="search" placeholder="Mot-cl√©, sujet..." value="<%= query.search || '' %>">
            </div>

            <div class="form-group">
                <label for="status">Filtrer par Statut :</label>
                <select id="status" name="status">
                    <option value="">-- Tous les Statuts --</option>
                    <% ['Draft', 'In Progress', 'Published', 'Archived'].forEach(s => { %>
                        <option value="<%= s %>" <%= query.status === s ? 'selected' : '' %>>
                            <%= s %>
                        </option>
                    <% }); %>
                </select>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 0; min-width: 250px;">
                
                <button type="submit" class="btn-apply" style="flex-grow: 1; height: 40px;">
                    Appliquer les Filtres
                </button>
                
                <a href="/" class="btn-reset" style="flex-grow: 1; text-align: center; display: flex; align-items: center; justify-content: center;">
                    R√©initialiser
                </a>
            </div>
        </form>
    </section>

    <hr style="border-color: var(--border-color);">

    <section class="filter-container">
        <h2>Ajouter une Nouvelle Id√©e</h2>
        <form action="/idea" method="POST">
            <div style="margin-bottom: 15px;">
                <label for="title" style="display: block; margin-bottom: 5px; font-weight: bold;">Titre de l'Id√©e :</label>
                <input type="text" id="title" name="title" required style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--main-bg-color); color: var(--text-color);">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label for="description" style="display: block; margin-bottom: 5px; font-weight: bold;">Description :</label>
                <textarea id="description" name="description" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--main-bg-color); color: var(--text-color);"></textarea>
            </div>
            
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="flex-grow: 1;">
                    <label for="category" style="display: block; margin-bottom: 5px; font-weight: bold;">Cat√©gorie (Blog/YouTube, etc.) :</label>
                    <input type="text" id="category" name="category" value="YouTube" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--main-bg-color); color: var(--text-color);">
                </div>
                <div style="flex-grow: 1;">
                    <label for="channelName" style="display: block; margin-bottom: 5px; font-weight: bold;">Cha√Æne concurrente (optionnel) :</label>
                    <input type="text" id="channelName" name="channelName" placeholder="Nom de la cha√Æne YouTube" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--main-bg-color); color: var(--text-color);">
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="background-color: #2ecc71;">
                Ajouter l'Id√©e
            </button>
        </form>
    </section>

    <hr style="border-color: var(--border-color);">

    <section>
        <h2>Liste de Vos Id√©es (<%= ideas.length %>)</h2>

        <% if (ideas.length > 0) { %>
            <div class="idea-grid">
                <% ideas.forEach(idea => { %>
                    <div class="idea-card">
                        <% const statusClass = 'status-' + (idea.status || 'Draft').replace(/\s/g, ''); %>
                        <span class="status-badge <%= statusClass %>">
                            <%= idea.status || 'Draft' %>
                        </span>
                        
                        <h3><%= idea.title %></h3>
                        
                        <p style="color: var(--secondary-color); font-size: 0.9em; margin-bottom: 15px;">
                            Cat√©gorie : <%= idea.category || 'G√©n√©ral' %>
                        </p>
                        
                        <p><%= idea.description.substring(0, 150) %>...</p>

                        <% if (idea.recentVideos && idea.recentVideos.length > 0) { %>
                            <h4 style="margin-top: 20px; color: #f39c12; font-size: 1em;">
                                üëÅÔ∏è Derni√®res vid√©os du concurrent
                            </h4>
                            <ul style="list-style-type: none; padding: 0;">
                                <% idea.recentVideos.forEach(video => { %>
                                    <li style="margin-bottom: 5px; font-size: 0.9em; display: flex; align-items: center;">
                                        <img src="<%= video.thumbnail %>" alt="Miniature" style="width: 40px; height: 30px; object-fit: cover; margin-right: 10px; border-radius: 3px;">
                                        <a href="https://www.youtube.com/watch?v=<%= video.videoId %>" target="_blank" style="color: var(--primary-color); text-decoration: none;">
                                            <%= video.title.substring(0, 40) %>...
                                        </a>
                                    </li>
                                <% }); %>
                            </ul>
                        <% } %>
                        
                        <div class="card-actions">
                            <a href="/dashboard/<%= idea._id %>" class="btn btn-primary">
                                Analyse d√©taill√©e
                            </a>
                            <a href="/edit/<%= idea._id %>" class="btn btn-secondary">
                                Modifier
                            </a>
                            <form action="/idea/delete/<%= idea._id %>" method="POST" onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cette id√©e ?');">
                                <button type="submit" class="btn btn-delete">
                                    Supprimer
                                </button>
                            </form>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <p class="no-ideas-message">
                Aucune id√©e trouv√©e correspondant √† vos crit√®res. Essayez de r√©initialiser les filtres.
            </p>
        <% } %>
    </section>

    <script>
        const body = document.body;
        const themeToggle = document.getElementById('theme-toggle');
        const themeKey = 'userTheme';

        function updateTheme(theme) {
            if (theme === 'light') {
                body.classList.add('light-mode');
                themeToggle.textContent = 'üåô Mode Nuit';
            } else {
                body.classList.remove('light-mode');
                themeToggle.textContent = '‚òÄÔ∏è Mode Jour';
            }
        }

        const savedTheme = localStorage.getItem(themeKey) || 'dark';
        updateTheme(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = body.classList.contains('light-mode') ? 'light' : 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            localStorage.setItem(themeKey, newTheme);
            updateTheme(newTheme);
        });
    </script>
</body>
</html>